<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Activity History - SEC TAMU</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;500;700&display=swap" rel="stylesheet">
    <style>
        .history-card {
            border: 1px solid #eee;
            border-radius: 10px;
            padding: 15px 20px;
            margin: 12px 0;
            background: #fafafa;
            box-shadow: 1px 2px 4px rgba(0,0,0,0.03);
            width: 100%;
            display: flex;
            flex-direction: column;
            gap: 6px;
        }
        .history-action {
            font-weight: 700;
            color: #500000;
            font-size: 1.1em;
        }
        .history-details {
            color: #333;
            font-size: 1em;
        }
        .history-name {
            font-style: italic;
            color: #666;
            font-size: 0.95em;
        }
    </style>
</head>
<body>
    <h1>Activity History</h1>
    <nav>
        <a href="/">Home</a> |
        <a href="/charts">Charts</a> |
        <a href="/history">History</a>
    </nav>
    <input type="text" id="historySearch" placeholder="Search actions or company..." style="margin-bottom:20px;max-width:400px;width:90%;display:block;margin-left:auto;margin-right:auto;">
    <div id="historyList" class="scroll-box"></div>
    <script>
        let allHistory = [];
        function renderHistory(filtered) {
            const list = document.getElementById('historyList');
            list.innerHTML = '';
            if (filtered.length === 0) {
                list.innerHTML = '<div style="text-align:center;color:#999;">No history found.</div>';
                return;
            }
            filtered.slice().reverse().forEach(item => {
                const card = document.createElement('div');
                card.className = 'history-card';
                card.innerHTML = `
                    <div class="history-action">${item.action.toUpperCase()}</div>
                    <div class="history-details">${item.details || ''}</div>
                    <div class="history-name">Company: <strong>${item.name}</strong></div>
                `;
                list.appendChild(card);
            });
        }
        function loadHistory() {
            fetch('/history_data')
                .then(res => res.json())
                .then(data => {
                    allHistory = data;
                    renderHistory(allHistory);
                });
        }
        document.getElementById('historySearch').addEventListener('input', function() {
            const q = this.value.trim().toLowerCase();
            const filtered = allHistory.filter(item =>
                item.action.toLowerCase().includes(q) ||
                (item.details && item.details.toLowerCase().includes(q)) ||
                item.name.toLowerCase().includes(q)
            );
            renderHistory(filtered);
        });
        document.addEventListener('DOMContentLoaded', loadHistory);
    </script>
</body>
</html>